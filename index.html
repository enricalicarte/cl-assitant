<script>
  const chatWindow = document.getElementById("chatWindow");
  const userInput = document.getElementById("userInput");

  function addMessage(content, sender) {
    const messageElement = document.createElement("div");
    messageElement.classList.add("chat-message", sender);

    const messageContent = document.createElement("div");
    messageContent.classList.add("message", sender);
    messageContent.textContent = content;

    messageElement.appendChild(messageContent);
    chatWindow.appendChild(messageElement);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  }

  async function sendMessage() {
    const message = userInput.value.trim();
    if (message === "") return;

    // Add user message to chat
    addMessage(message, "user");
    userInput.value = "";

    // Send message to webhook
    try {
      const response = await fetch("https://multiplicaenric.app.n8n.cloud/webhook-test/527dea54-5355-4717-bbb7-59ecd936269b", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          message: message,
        }),
      });

      // Check if the response is JSON
      const contentType = response.headers.get("content-type");
      let data;
      if (contentType && contentType.includes("application/json")) {
        data = await response.json();
      } else {
        data = { output: await response.text() };
      }

      const botResponse = data.output || "Respuesta no disponible";
      addMessage(botResponse, "bot");
    } catch (error) {
      console.error("Error al conectar con el servidor:", error);
      addMessage("Error al conectar con el servidor.", "bot");
    }
  }
</script>
